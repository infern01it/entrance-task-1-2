# Задание 1 — найди ошибки

В этом репозитории находятся материалы тестового задания "Найди ошибки" для [14-й Школы разработки интерфейсов](https://academy.yandex.ru/events/frontend/shri_msk-2018-2) (осень 2018, Москва, Санкт-Петербург, Симферополь).

Для работы тестового приложения нужен Node.JS v9. В проекте используются [Yandex Maps API](https://tech.yandex.ru/maps/doc/jsapi/2.1/quick-start/index-docpage/) и [ChartJS](http://www.chartjs.org).

## Задание

Код содержит ошибки разной степени критичности. Некоторые из них — стилистические, а другие — даже не позволят вам запустить приложение. Вам нужно найти все ошибки и исправить их.

Пункты для самопроверки:

1. Приложение должно успешно запускаться.
1. По адресу http://localhost:9000 должна открываться карта с метками.
1. Должна правильно работать вся функциональность, перечисленная в условиях задания.
1. Не должно быть лишнего кода.
1. Все должно быть в едином codestyle.

## Запуск

```
npm i
npm start
```

При каждом запуске тестовые данные генерируются заново случайным образом.

## Решение

1. Первую ошибку я заметил запустив приложение и открыв консоль, связана она с неправильным импортом функции инициализации карты. Решить эту проблему можно было 2мя способами (не считая копирования всего в 1н файл :)) - либо обернуть initMap в фигурные скобки в index.js (т.к. функция экспортируется не по умолчанию ), либо добавить default после export в файле map.js чтоб функция экспортировалась по умолчанию. Поскольку во всем проекте нет импорта по умолчанию, я решил не отходить от стиля... 

2. Далее приложение вроди бы запустилось без ошибок в консоли, однако карту небыло видно. Ошибку я обнаружил "просматривая код элемента" у карты была нулевая высота... Это было связано с тем что высота карты ни где не задана. Исправляется эта ошибка добавлением стилей #map в файле index.css, добавлением стилей инлайново, или добавлением атрибутов к данному блоку... 

3. Теперь приложение открывалось, и карта была видна, но меток на ней небыло. Потому что они просто не добавлены на карту, я добавил все обьекты на карту "myMap.geoObjects.add(objectManager);" и думал что все должно быть уже хорошо, но ни тут то было... 

4. Эту ошибку я не мог найти минут 10 пока не решил отдалить карту на максимум. тут я увидел что все метки расположены в другом месте, это означало что координаты неверные, ведь карта должна быть по условиям над Москвой и метки получается тоже... в файле map.js перед добавлением объекта в objectManager проверил какие данные в него поступают и вроди бы ничего подозрительного в них не увидел, пошел дальше api.js - тут данные после получения обрабатывались в функции mapServerData, в ней я и обнаружил что координаты lat и long стоят не в том порядке, поменял их местами и метки переместились в Москву. 

5. По условиям задания кластер с метками должен был показывать если в нем содержаться неисправные станции, но все кластеры были зелеными. Посмотрев в песочнеце яндекс карт примеры с кластерами я увидел кластеризацию в виде круговой диаграмы - она как раз подходила, но при создании кластеризатора в map.js и так был использован данный вид кластеров, но ниже был метод переопределения вида метки кластера, который нужно было удалить. теперь кластеры отображались как нужно. 

6. Следующая ошибка обнаружилась при клике на метку, я поставил метку debugger внутри then'a функции loadDetails - ошибок небыло, данные приходили нормально... Далее я открыл функцию создания балуна матки (тут я уже добавлял отстутствующий закрывающий див в шаблонизаторе почти в самом начале когда просматривал файлы искав еще ошибки импорта) и поставил debugger внутри метода build после определения переменной details, тут уже были ошибки... Я пошел читать документацию и смотреть примеры в песочнице. В Api я примеров не нашел, а в песочнице был очень похожий пример, в нем вместо стрелочных функций использовались обычные, а вместо BalloonContentLayout - this.constructor, но как оказалось this.constructor и BalloonContentLayout один и тот-же объект... Поэтому я просто исправил стрелочные функции на обычные и все заработало (как я понимаю все потому что стрелочные функции обращались к другому this) 

7. Все работало нормально за исключением графиков в балунах, на исправных станциях их небыло, а на неисправных было что-то не то... Ошибку я пошел искать в функцию создания этого самого графика, почитав апи chart.js и посмотрев какие опции в него передаются, я заметил что максимальным значением графика выставлен 0, я решил исправить его на число максимальной нагрузки на станцию за данный период времени (максимальное число из массива)... 

Теперь все работало, все стреляло, ошибок в фильтре вроди нет. 